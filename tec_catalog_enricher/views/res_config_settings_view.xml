<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="res_config_settings_view_form_enricher" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.enricher</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="tec_dropshipping_core.res_config_settings_view_form_core"/>
        <field name="arch" type="xml">
            <xpath expr="//block[@id='tec_ecommerce_suite_settings_core']" position="after">
                <block title="Inteligencia de Catálogo (Enrichment)" id="tec_catalog_enricher_settings">
                    
                    <!-- SECCIÓN 1: FUENTES OFICIALES -->
                    <div class="o_horizontal_separator mt-4">Fuentes Oficiales &amp; Catálogos</div>
                    <div class="row mt-2">
                        <!-- Lenovo PSREF -->
                        <div class="col-12 col-lg-6">
                            <setting string="Lenovo PSREF" help="Catálogo oficial de Lenovo (Sin API Key).">
                                <field name="use_lenovo_psref"/>
                                <div class="mt-2" invisible="not use_lenovo_psref">
                                    <button name="action_test_lenovo_psref" type="object" string="Probar PSREF" class="btn btn-secondary btn-sm" icon="fa-refresh"/>
                                </div>
                            </setting>
                        </div>
                        <!-- Icecat -->
                        <div class="col-12 col-lg-6">
                            <setting string="Icecat Catalogue" help="Catálogo abierto IT (Basic o JSON).">
                                <field name="use_icecat"/>
                                <div class="mt-2" invisible="not use_icecat">
                                    <field name="icecat_auth_method" widget="radio" class="mb-3"/>
                                    
                                    <div invisible="icecat_auth_method == 'token'" class="o_setting_box_content">
                                        <div class="row align-items-center mb-1">
                                            <label for="icecat_username" string="Usuario" class="col-4 o_light_label"/>
                                            <field name="icecat_username" class="col-8"/>
                                        </div>
                                        <div class="row align-items-center mb-1">
                                            <label for="icecat_password" string="Password" class="col-4 o_light_label"/>
                                            <field name="icecat_password" password="True" class="col-8"/>
                                        </div>
                                    </div>

                                    <div invisible="icecat_auth_method == 'basic'" class="o_setting_box_content">
                                        <div class="row align-items-center mb-1">
                                            <label for="icecat_api_token" string="App Key" class="col-4 o_light_label"/>
                                            <field name="icecat_api_token" class="col-8"/>
                                        </div>
                                        <div class="row align-items-center mb-1">
                                            <label for="icecat_content_token" string="Content" class="col-4 o_light_label"/>
                                            <field name="icecat_content_token" password="True" class="col-8"/>
                                        </div>
                                    </div>

                                    <div class="mt-3">
                                        <button name="action_test_icecat" type="object" string="Probar Icecat" class="btn btn-secondary btn-sm" icon="fa-check-circle"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                    </div>

                    <!-- SECCIÓN 2: MOTORES WEB & FALLBACK -->
                    <div class="o_horizontal_separator mt-5">Escraping &amp; Fallback Web</div>
                    <div class="row mt-2">
                        <!-- Google Search -->
                        <div class="col-12 col-lg-6">
                            <setting string="Google Search API" help="Búsqueda de imágenes y Datasheets (CSE).">
                                <field name="use_google"/>
                                <div class="mt-2" invisible="not use_google">
                                    <div class="row align-items-center mb-1">
                                        <label for="google_cse_key" string="API Key" class="col-4 o_light_label"/>
                                        <field name="google_cse_key" password="True" class="col-8"/>
                                    </div>
                                    <div class="row align-items-center mb-1">
                                        <label for="google_cse_cx" string="CX ID" class="col-4 o_light_label"/>
                                        <field name="google_cse_cx" class="col-8"/>
                                    </div>
                                    <div class="mt-3">
                                        <button name="action_test_google_search" type="object" string="Probar Google" class="btn btn-secondary btn-sm" icon="fa-search"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                        <!-- YouTube -->
                        <div class="col-12 col-lg-6">
                            <setting string="YouTube Integration" help="Búsqueda de Unboxings y Reviews.">
                                <field name="use_youtube"/>
                                <div class="mt-2" invisible="not use_youtube">
                                    <div class="row align-items-center mb-2">
                                        <div class="col-12 text-muted mb-2" style="font-size: 0.85em;">
                                            <i class="fa fa-info-circle me-1"/> 
                                            Key en: <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com" target="_blank">Google Cloud</a>
                                        </div>
                                        <label for="youtube_api_key" string="API Key" class="col-4 o_light_label"/>
                                        <field name="youtube_api_key" password="True" class="col-8"/>
                                    </div>
                                    <div class="mt-1">
                                        <button name="action_test_youtube" type="object" string="Probar YouTube" class="btn btn-secondary btn-sm" icon="fa-youtube-play"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <!-- Best Buy -->
                        <div class="col-12 col-lg-6">
                            <setting string="Best Buy API" help="Datos retail USA.">
                                <field name="use_bestbuy"/>
                                <div class="mt-2" invisible="not use_bestbuy">
                                    <div class="row align-items-center mb-1">
                                        <label for="bestbuy_api_key" string="API Key" class="col-4 o_light_label"/>
                                        <field name="bestbuy_api_key" password="True" class="col-8"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                        <!-- POD -->
                        <div class="col-12 col-lg-6">
                            <setting string="Product Open Data" help="Base de datos abierta (Open Food Facts / POD).">
                                <field name="use_pod"/>
                                <div class="mt-2" invisible="not use_pod">
                                    <button name="action_test_pod" type="object" string="Probar POD" class="btn btn-secondary btn-sm" icon="fa-globe"/>
                                </div>
                            </setting>
                        </div>
                    </div>

                    <!-- SECCIÓN 3: INTELIGENCIA ARTIFICIAL -->
                    <div class="o_horizontal_separator mt-5">Cerebro AI (Generador de Contenido)</div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <setting string="Proveedor Activo" help="IA asignada para redacción SEO.">
                                <field name="ai_provider" widget="radio" class="d-flex justify-content-start gap-5"/>
                            </setting>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <!-- Gemini -->
                        <div class="col-12 col-lg-6">
                            <setting string="Google Gemini" help="Velocidad y costo optimizado.">
                                <field name="use_gemini"/>
                                <div class="mt-2" invisible="not use_gemini">
                                    <div class="row align-items-center mb-1">
                                        <label for="gemini_api_key" string="API Key" class="col-4 o_light_label"/>
                                        <field name="gemini_api_key" password="True" class="col-8"/>
                                    </div>
                                    <div class="row align-items-center mb-1">
                                        <label for="gemini_model" string="Modelo" class="col-4 o_light_label"/>
                                        <field name="gemini_model" class="col-8"/>
                                    </div>
                                    <div class="mt-3">
                                        <button name="action_test_gemini" type="object" string="Probar Gemini" class="btn btn-secondary btn-sm" icon="fa-magic"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                        <!-- OpenAI -->
                        <div class="col-12 col-lg-6">
                            <setting string="OpenAI GPT" help="La IA más precisa para IT.">
                                <div class="mt-1">
                                    <div class="row align-items-center mb-1">
                                        <label for="openai_api_key" string="API Key" class="col-4 o_light_label"/>
                                        <field name="openai_api_key" password="True" class="col-8"/>
                                    </div>
                                    <div class="row align-items-center mb-1">
                                        <label for="openai_model" string="Modelo" class="col-4 o_light_label"/>
                                        <field name="openai_model" class="col-8"/>
                                    </div>
                                    <div class="mt-3">
                                        <button name="action_test_openai" type="object" string="Probar GPT" class="btn btn-secondary btn-sm" icon="fa-bolt"/>
                                    </div>
                                </div>
                            </setting>
                        </div>
                    </div>

                    <!-- SECCIÓN 4: CONFIGURACIÓN AVANZADA IA -->
                    <div class="o_horizontal_separator mt-5" invisible="not use_gemini and not openai_api_key">Ajustes del Prompt Maestro</div>
                    <div class="row mt-2" invisible="not use_gemini and not openai_api_key">
                        <div class="col-12 col-lg-5">
                            <setting string="Insumos para IA" help="Filtra los datos fuente.">
                                <div class="d-flex flex-wrap gap-4 mt-2">
                                    <div class="d-flex align-items-center"><field name="ai_input_name" class="me-1"/><label for="ai_input_name" class="mb-0"/></div>
                                    <div class="d-flex align-items-center"><field name="ai_input_brand" class="me-1"/><label for="ai_input_brand" class="mb-0"/></div>
                                    <div class="d-flex align-items-center"><field name="ai_input_category" class="me-1"/><label for="ai_input_category" class="mb-0"/></div>
                                    <div class="d-flex align-items-center"><field name="ai_input_description_air" class="me-1"/><label for="ai_input_description_air" class="mb-0"/></div>
                                    <div class="d-flex align-items-center"><field name="ai_input_description_enrich" class="me-1"/><label for="ai_input_description_enrich" class="mb-0"/></div>
                                </div>
                            </setting>
                        </div>
                        <div class="col-12 col-lg-7">
                            <setting string="Prompt Maestro" help="Instrucciones SEO.">
                                <field name="ai_custom_prompt" widget="text" class="w-100" placeholder="Instrucciones expertas..."/>
                            </setting>
                        </div>
                    </div>

                    <!-- SECCIÓN 5: GOBERNANZA -->
                    <div class="o_horizontal_separator mt-5">Gobernanza &amp; Marketplaces</div>
                    <div class="row mt-2">
                        <div class="col-12 col-lg-6">
                            <setting string="Límites de Multimedia" help="Configuración de guardado.">
                                <div class="row align-items-center mb-1">
                                    <label for="max_images_limit" string="Límite Fotos" class="col-4 o_light_label"/>
                                    <field name="max_images_limit" class="col-8 oe_inline"/>
                                </div>
                            </setting>
                        </div>
                        <div class="col-12 col-lg-6">
                            <setting string="MercadoLibre Sync" help="Mapeo Marketplace.">
                                <div class="row align-items-center mb-1">
                                    <label for="tec_meli_api_url" string="API URL" class="col-4 o_light_label"/>
                                    <field name="tec_meli_api_url" class="col-8"/>
                                </div>
                                <div class="mt-2 d-flex align-items-center">
                                    <field name="tec_meli_enable_ai_mapping" class="me-2"/><label for="tec_meli_enable_ai_mapping" class="mb-0"/>
                                </div>
                            </setting>
                        </div>
                    </div>
                </block>
            </xpath>
        </field>
    </record>
</odoo>
